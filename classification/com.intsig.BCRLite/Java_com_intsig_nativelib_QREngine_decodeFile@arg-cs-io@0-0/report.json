{
  "analysis": {
    "tool": {
      "model_name": "gpt-5.1",
      "apk_path": "APKs_FINAL/com.intsig.BCRLite/base.apk",
      "version": "1.0"
    },
    "app": {
      "app_name": "0x7f1100df",
      "package": "com.intsig.BCRLite",
      "min_sdk": 28,
      "target_sdk": 31,
      "version_name": "7.63.5.20230731",
      "version_code": "76350"
    },
    "analysisResults": [
      {
        "crash": {
          "ProcessTermination": "abort",
          "StackTrace": [
            "abort",
            "__stack_chk_fail",
            "Java_com_intsig_nativelib_QREngine_decodeFile",
            "fuzz_one_input",
            "main"
          ],
          "JNIBridgeMethod": "<android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
          "JavaCallGraph": [
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <kf.d: t(Ljava/lang/String;Ljava/lang/String;)V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <cf.b: doInBackground([Ljava/lang/Object;)Ljava/lang/Object;> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <eo.d: run()V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <ob.m2: handleMessage(Landroid/os/Message;)V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <com.intsig.camcard.EditContactActivity2: K0()V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <bg.c: t(Ljava/lang/String;Ljava/lang/String;)V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <com.adjust.sdk.m0: c()V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <com.intsig.camcard.EditContactActivity2: J0()V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <mi.b: run()V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <oi.d1: d(Landroidx/fragment/app/FragmentActivity;Lcom/intsig/tianshu/imhttp/ShareCardMsg;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Lcom/intsig/isshare/SharedData;)V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <com.intsig.camcard.EditContactActivity2: b1()V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <ob.u0: run()V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <ob.e1: doInBackground([Ljava/lang/Object;)Ljava/lang/Object;> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <l7.x1: t(Ljava/lang/String;Ljava/lang/String;)V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>",
            "<ob.z2: J1(Ljava/lang/String;)Landroid/graphics/Bitmap;> -> <com.intsig.camcard.cardholder.ExportContactsActivity: onCreate(Landroid/os/Bundle;)V> -> <android.graphics.BitmapFactory: decodeFile(Ljava/lang/String;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;>"
          ],
          "FuzzHarnessEntry": "fuzz_one_input",
          "ProgramEntry": "main",
          "LibMap": {
            "APKs_FINAL/com.intsig.BCRLite/lib/arm64-v8a/libQREngine.so": [
              "Java_com_intsig_nativelib_QREngine_decodeFile",
              "Java_com_intsig_nativelib_QREngine_decodeFile"
            ]
          }
        },
        "assessment": {
          "chain_of_thought": [
            "Top native frame below runtime is Java_com_intsig_nativelib_QREngine_decodeFile in libQREngine.so; decompiled body shows direct logic and stack layout.",
            "Function takes JNI env (param_1), jclass (param_2), and jstring (param_3). It uses JNI calls at vtbl offsets 0x540, 0x548, 0x550: likely GetStringLength, GetStringUTFChars/GetStringChars, ReleaseStringUTFChars/ReleaseStringChars.",
            "It allocates a fixed 256-byte stack buffer acStack_158, then calls strcpy(acStack_158, __src) using the string contents from the Java jstring without any bounds check or length check relative to 256.",
            "Immediately after strcpy, it calls JNI ReleaseString... and then sets acStack_158[iVar3] = '\\0' where iVar3 is the length obtained earlier. If iVar3 >= 256, the previous strcpy has already overflown acStack_158 (CWE-121/787). The index write also extends overflow by one byte. Both operations are attacker-influenced via the Java string contents/length.",
            "The crash termination is abort via __stack_chk_fail, which is exactly what we expect from a stack canary detecting corruption from a buffer overflow on acStack_158 or nearby locals.",
            "Backward data flow: length (iVar3) and pointer (__src) come straight from JNI env operations on param_3; nothing clamps them to <256. MsDecodeFile and DecodeQR operate after the overflow and do not affect whether overflow happens; they likely influence where/when crash manifests but not root cause.",
            "Java call graph shows multiple app entry paths (EditContactActivity2, ExportContactsActivity, ShareCardMsg handling, etc.) that eventually call ob.z2.J1(String) which leads to BitmapFactory.decodeFile, but the native QR decodeFile function we analysed uses a file path string from Java directly. The environment/fuzzer simply calls BitmapFactory.decodeFile with arbitrary path values; in real app this path can come from external storage or shared content URIs, thus influenced by attacker under some conditions.",
            "Therefore, we have a clear, app-level, attacker-controllable stack-based buffer overflow via unsafe strcpy into a 256-byte local buffer from an unbounded Java string. This is a genuine, likely exploitable memory safety vulnerability with high severity. The harness is not required to pass impossible values; any long file path string (>=256 bytes, possibly including multi-byte encodings) could trigger it.",
            "Exploitability: Stack canary currently converts this to abort, but on builds without canary or with other compilation modes, it is a classic stack overflow that could be used for control-flow hijack. Even with canary, an attacker can reliably crash the app (DoS) via crafted long path strings passed to the QR decoding API. Given JNI and multiple Java callers, it is reachable via e.g. sharing a contact image with a specially named file or path if the app lets user pick/import from storage."
          ],
          "is_vulnerable": true,
          "confidence": 0.96,
          "reasons": [
            "Stack-based buffer overflow in Java_com_intsig_nativelib_QREngine_decodeFile via strcpy into 256-byte local buffer from unbounded Java string",
            "Abort via __stack_chk_fail is consistent with stack canary detecting overflow of acStack_158 or adjacent locals",
            "Input (file path string) is ultimately controlled by app-level code and can be influenced by attacker via external storage, shared files, or IPC"
          ],
          "cwe_ids": [
            "CWE-121",
            "CWE-787"
          ],
          "severity": "high",
          "affected_libraries": [
            "libQREngine.so"
          ],
          "evidence": [
            {
              "function": "Java_com_intsig_nativelib_QREngine_decodeFile",
              "address": "00107a24",
              "file": "libQREngine.so",
              "snippet": "iVar3 = (**(code **)(*param_1 + 0x540))(param_1,param_3);\n__src = (char *)(**(code **)(*param_1 + 0x548))(param_1,param_3,0);\nstrcpy(acStack_158,__src);\n(**(code **)(*param_1 + 0x550))(param_1,param_3,__src);\nacStack_158[iVar3] = '\\0';\n...\n__stack_chk_fail(uVar4);",
              "note": "Unbounded strcpy copies JNI string into fixed 256-byte stack buffer; stack canary fail indicates overflow."
            },
            {
              "function": "Java_com_intsig_nativelib_QREngine_decodeFile",
              "address": "00107a24",
              "file": "libQREngine.so",
              "snippet": "char acStack_158 [256];\n...\nstrcpy(acStack_158,__src);\nacStack_158[iVar3] = '\\0';",
              "note": "Buffer is 256 bytes, but code uses full JNI string length without checking <256."
            }
          ],
          "call_sequence": [
            "fuzz_one_input -> Java_com_intsig_nativelib_QREngine_decodeFile @ 00107a24"
          ],
          "recommendations": [
            "Replace strcpy with strncpy or memcpy using a length bounded by sizeof(acStack_158)-1 and ensure explicit null termination",
            "Add robust path length validation on the JNI side before copying file paths or other strings into fixed-size buffers",
            "Rebuild native library with stack canaries and full RELRO (already partially present) and add tests with long file paths to prevent regression"
          ],
          "assumptions": [
            "Java-level file path strings reaching QREngine.decodeFile can be influenced by a user or external source (e.g., filenames, shared URIs)",
            "The decompiled JNI function body is accurate and corresponds to the shipping production binary",
            "No hidden pre-validation in Java restricts path length below 256 characters"
          ],
          "limitations": [
            "Exact Java call sites of QREngine.decodeFile (distinct from BitmapFactory.decodeFile) are not fully enumerated in the provided callgraph",
            "Lack of Java source for ob.z2.J1 and related methods prevents precise attacker-control modeling of input paths"
          ],
          "exploit": {
            "exploitability": "theoretical",
            "trigger_method": "Supplying an overly long file path to the QR decoding JNI method via Java APIs that wrap QREngine.decodeFile",
            "prerequisites": [
              "Attacker can cause the app to open or process an image or file from a path they control (e.g., external storage or shared file)",
              "Build is compiled with this vulnerable libQREngine.so and JNI entry point exposed via app code"
            ],
            "exploit_pipeline": [
              "Craft or select an image/file whose full path on the device exceeds 256 characters (e.g., /sdcard/Download/<very_long_name>.png) and ensure it is accessible to the app",
              "Use an app feature that imports or decodes QR/bitmap images and selects this long-path file, leading to a Java call into the QREngine.decodeFile JNI method with the long path string",
              "Trigger the native code; the unbounded strcpy into acStack_158 overflows the stack, causing __stack_chk_fail and abort, or potentially enabling control-flow hijack in less-protected builds"
            ],
            "poc_commands": [
              "adb push longname_qr.png /sdcard/Download/$(python3 - << 'EOF'\nimport os\nname = 'A' * 260 + '.png'\nprint(name)\nEOF)",
              "adb shell am start -n com.intsig.BCRLite/.MainActivity --es image_path \"/sdcard/Download/<very_long_260+_char_name>.png\"",
              "adb logcat | grep QREngine"
            ],
            "poc_files": [
              "/sdcard/Download/<very_long_260+_char_name>.png"
            ],
            "notes": "Exact Java method to call QREngine.decodeFile is app-specific; PoC commands assume there is an activity/intent path that takes an image_path extra and eventually calls the JNI function. Adjust component/class names to match actual entrypoint in the app."
          }
        },
        "statistics": {
          "time": "00:00:32",
          "llm_requests": 3,
          "llm_tool_calls": 2,
          "input_tokens": 22472,
          "output_tokens": 1872
        }
      }
    ]
  }
}